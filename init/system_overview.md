# 超临界CO2布雷顿循环与余热回收系统代码说明文档

## 1. 引言

本文档旨在简要说明用于复现论文《超临界CO2布雷顿循环余热回收系统性能分析与优化》中相关计算的三个核心 Python 脚本：[`state_point_calculator.py`](state_point_calculator.py)，[`cycle_components.py`](cycle_components.py) 和 [`full_cycle_simulator.py`](full_cycle_simulator.py)。我们将分别介绍它们的作用、代码用于验证的原理、关键数据的来源，并对后续可能的计划进行展望。

目标是让读者能够快速理解这套代码的结构和功能，即使不深入每一行代码，也能把握其核心思想和用途。

## 2. 各脚本功能说明

### 2.1. `state_point_calculator.py` - 状态点物性计算器

这个脚本是整个分析的基础，主要负责：

*   **定义热力学状态点 (`StatePoint` 类)**：它能根据给定的参数（如压力P、温度T，或压力P、焓h等）计算出工质（如CO2、R245fa）在该状态下的其他重要热力学性质，例如焓、熵、密度、㶲等。这是通过调用专业的物性计算库 `CoolProp` 实现的。
*   **单位转换**：提供了一些方便的函数，用于在常用单位（如摄氏度、kPa、bar）和国际标准单位（开尔文、Pa）之间进行转换。
*   **㶲计算参考态设定**：定义了计算㶲值时所需的环境参考状态（温度T0和压力P0）。脚本中当前设定的值（T0 = 9.56°C, P0 = 101.382 kPa）并非标准的25°C参考大气。这些特定值是基于脚本内建的 `run_t0_p0_fitting()` 函数（该函数利用论文表10数据进行最小二乘法拟合，旨在找出使计算㶲与论文㶲数据误差最小的参考态，尽管此函数在主执行流程中可能被注释掉了）反推或尝试得到的。选择这些特定值是为了更好地复现论文中的㶲分析结果。如果采用标准的25°C参考态，计算出的㶲值与论文数据相比可能会表现出更大的差异。这一点对于理解㶲分析结果的对比非常重要。
*   **论文数据验证与对比**：脚本内嵌了来自论文（主要是表10）的状态点数据。它会利用这些数据，通过 `StatePoint` 类重新计算物性，特别是㶲值，并与论文中给出的值进行对比，以验证物性计算的准确性。计算结果会输出到控制台并保存到 CSV 文件 ([`calculated_state_points_from_table10.csv`](calculated_state_points_from_table10.csv))。
*   **生成循环参数配置文件**：脚本会根据论文中的一些关键参数（如循环的初始点参数、部件效率等），生成一个名为 [`cycle_setup_parameters.json`](cycle_setup_parameters.json) 的JSON文件。这个文件将作为后续完整循环模拟的输入。
*   **(可选) 参考态反推**：代码中还包含了根据论文数据反推最优环境参考态T0/P0的功能，目前采用的就是反推之后的结果。

简单来说，[`state_point_calculator.py`](state_point_calculator.py) 确保了我们能够准确获取任意工况下的工质物性，并为后续的部件和系统模拟提供了基础数据和配置文件。

### 2.2. `cycle_components.py` - 热力循环核心组件模型库

这个脚本定义了构成热力循环的各个核心硬件组件的数学模型。它就像一个工具箱，提供了模拟不同设备行为的模块：

*   **压缩机/泵模型** ([`model_compressor_MC`](cycle_components.py:25), [`model_pump_ORC`](cycle_components.py:128)): 模拟工质在压缩机或泵中被压缩（或加压）的过程。输入包括进口状态、目标出口压力和等熵效率，输出为出口状态和耗功。
*   **透平模型** ([`model_turbine_T`](cycle_components.py:77)): 模拟工质在透平中膨胀做功的过程。输入包括进口状态、目标出口压力和等熵效率，输出为出口状态和产功。
*   **换热器模型 (基于效能)** ([`model_heat_exchanger_effectiveness`](cycle_components.py:176)): 模拟回热器这类设备，其中换热量通过换热器效能（Effectiveness-NTU法中的效能ε）来确定。
*   **蒸发器/气体冷却器模型** ([`model_evaporator_GO`](cycle_components.py:275)): 专门用于模拟S-CO2循环与ORC循环之间的耦合换热设备（论文中的GO）。它允许通过指定一侧的出口条件来确定换热量。
*   **冷却器模型** ([`model_cooler_set_T_out`](cycle_components.py:338)): 模拟将工质冷却到特定温度或饱和液体状态的过程，如主冷却器或ORC的冷凝器。
*   **加热器模型** ([`model_heater_set_T_out`](cycle_components.py:393)): 模拟工质从外部热源吸热的过程，如S-CO2循环中的吸热器ER。

每个模型都接收进口状态点对象（来自 `state_point_calculator.py`）和一些设备特性参数（如效率、目标温度/压力等），然后计算出出口状态点对象以及相关的能量交换（如功、热量）。脚本内部也包含了一些测试代码，用于验证这些组件模型的正确性。
例如，在 [`cycle_components.py`](cycle_components.py:441) 脚本末尾的 `if __name__ == '__main__':` 代码块中，针对主压缩机（MC）模型的测试会产生如下格式的输出：

```
--- 测试主压缩机 (MC) 模型 ---

进口状态 (点1 测试 MC):
状态点: 测试用SCBC点1_MC (CO2)
  P = 7.400 MPa
  T = 35.00 °C
  h = 402.40 kJ/kg
  s = 1.6634 kJ/kgK
  d = 259.77 kg/m³
  e = 200.34 kJ/kg
  Q = N/A
  m_dot = 1945.09 kg/s

计算得到的MC出口状态 (点2 计算):
状态点: 测试用SCBC点1_MC (CO2)
  P = 24.198 MPa
  T = 121.73 °C
  h = 453.36 kJ/kg
  s = 1.6829 kJ/kgK
  d = 484.27 kg/m³
  e = 245.79 kJ/kg
  Q = 过热/超临界
  m_dot = 1945.09 kg/s
MC单位质量压缩功: 50.95 kJ/kg

与论文表10 SCBC点2 对比 (MC):
  计算MC出口温度 T: 121.73 °C (论文: 121.73 °C)
  计算MC出口焓 h: 453.36 kJ/kg (论文: 453.36 kJ/kg)
  计算MC压缩功: 50.95 kJ/kg (论文近似值: 50.96 kJ/kg)
```

在这段输出中：
*   **输入参数** 包括：
    *   **进口状态 (点1 测试 MC)** 中的 `P = 7.400 MPa` 和 `T = 35.00 °C` (以及流体类型 "CO2" 和质量流量 `m_dot = 1945.09 kg/s`)。这些是直接在测试代码中 ([`cycle_components.py:444-452`](cycle_components.py:444)) 设定的初始条件。
    *   压缩机的目标出口压力，即 **计算得到的MC出口状态 (点2 计算)** 中的 `P = 24.198 MPa` (在测试代码中由 [`P2_Pa_test_mc`](cycle_components.py:448) 定义)。
    *   压缩机的等熵效率 (在测试代码中设定为 [`eta_mc_test = 0.85`](cycle_components.py:447))。
*   **代码计算得出的结果** 包括：
    *   **进口状态 (点1 测试 MC)** 中的热力学性质 `h`, `s`, `d`, `e` 和相态 `Q`。这些是基于输入的P和T，通过 [`StatePoint` 类](state_point_calculator.py)调用 `CoolProp` 计算得到的 ([`cycle_components.py:451`](cycle_components.py:451))。
    *   **计算得到的MC出口状态 (点2 计算)** 中的所有热力学性质 (`T`, `h`, `s`, `d`, `e`, `Q`)。这些是基于进口状态、目标出口压力和等熵效率，通过 [`model_compressor_MC`](cycle_components.py:25) 函数计算得到的 ([`cycle_components.py:457`](cycle_components.py:457))。质量流量 `m_dot` 从进口传递。
    *   **MC单位质量压缩功: 50.95 kJ/kg**。这是由 [`model_compressor_MC`](cycle_components.py:25) 函数计算得到的 ([`cycle_components.py:457`](cycle_components.py:457))。
    *   **与论文表10 SCBC点2 对比 (MC)** 部分中的 "计算MC出口温度 T", "计算MC出口焓 h", 和 "计算MC压缩功" 均是代码的计算结果，用于和论文数据进行比较 ([`cycle_components.py:462-467`](cycle_components.py:462))。

这样的说明有助于理解脚本的测试输出是如何与模型的输入输出参数对应的。

### 2.3. `full_cycle_simulator.py` - 完整热力循环模拟器

这是将所有部件模型“组装”起来，模拟整个S-CO2布雷顿循环和ORC联合循环运行的脚本。其主要工作流程如下：

*   **加载配置参数**：首先从 [`cycle_setup_parameters.json`](cycle_setup_parameters.json) 文件中读取由 [`state_point_calculator.py`](state_point_calculator.py) 生成的循环配置参数。
*   **S-CO2循环模拟**:
    *   **初始化**: 设定S-CO2循环的起始点（如主压缩机进口P1）的状态。
    *   **部件计算**: 依次调用 [`cycle_components.py`](cycle_components.py) 中定义的模型，计算主压缩机、回热器（LTR、HTR）、吸热器（ER）、透平、再压缩机（RC）、气体冷却器（GO的热侧）、主冷却器（CS）等部件的出口状态和性能。
    *   **迭代求解**: 由于S-CO2再压缩布雷顿循环中存在回热和分流，某些状态点（如透平出口、回热器出口）的确定需要迭代计算，直到关键参数（如焓值）收敛到稳定值。
*   **ORC循环模拟**:
    *   **热量耦合**: 从S-CO2循环在GO中放出的热量作为ORC循环的蒸发器（GO的冷侧）的输入热量。
    *   **部件计算**: 依次计算ORC的泵、蒸发器、透平、冷凝器的状态和性能。
*   **性能评估**: 计算S-CO2循环、ORC循环以及整个联合循环的净输出功、热效率等关键性能指标。
*   **结果输出**: 将详细的模拟过程（包括每个状态点的参数、部件的性能、循环的整体性能）打印到控制台，并保存到文本文件 ([`full_cycle_simulator_output.txt`](full_cycle_simulator_output.txt)) 中，供后续分析。

简单来说，[`full_cycle_simulator.py`](full_cycle_simulator.py) 是总指挥，它利用前两个脚本提供的工具和数据，完整地模拟了论文中复杂的联合循环系统。

## 3. 验证原理

这套代码的验证主要依赖于与原始论文中数据的对比：

*   **状态点参数对比**：[`state_point_calculator.py`](state_point_calculator.py) 和 [`full_cycle_simulator.py`](full_cycle_simulator.py) 都会计算循环中各个关键状态点的热力学参数（如压力、温度、焓、熵、㶲）。这些计算值会与论文中表格（特别是表10）给出的参考值进行比较。如果计算值与论文值吻合度高，则说明物性计算和基本的状态点确定是准确的。
*   **部件性能对比**：在 [`cycle_components.py`](cycle_components.py) 的测试部分和 [`full_cycle_simulator.py`](full_cycle_simulator.py) 的模拟过程中，会计算压缩机/泵的耗功、透平的产功等。这些也可以与论文中间接推算或直接给出的部件性能数据进行比较。
*   **循环整体性能对比**：最终，[`full_cycle_simulator.py`](full_cycle_simulator.py) 计算出的S-CO2循环效率、ORC效率以及联合循环的总效率，可以与论文中分析和优化的结果进行对比，以验证整个系统模型的准确性。

通过这些多层次的对比，可以评估代码复现论文结果的程度。需要注意的是，物性数据库的微小差异、模型简化程度的不同，都可能导致计算结果与论文数据存在一定的偏差。

## 4. 数据来源说明

代码中采用的关键数据主要来源于您提供的论文《超临界CO2布雷顿循环余热回收系统性能分析与优化_余廷芳.pdf》以及一些热力学通用参数：

*   **工质物性**: 来自 `CoolProp` 库，这是一个广泛使用的开源物性计算库。
*   **环境参考态 (T0, P0)**: 如前所述，在 [`state_point_calculator.py`](state_point_calculator.py) 中设定的 T0=9.56°C, P0=101.382 kPa 是为了最小化与论文表10中㶲数据的计算误差而反推或尝试得出的特定值，并非标准参考态。论文本身并未明确给出其㶲计算所用的精确参考态。
*   **循环初始参数**:
    *   S-CO2循环的压缩机入口压力和温度（如P1=7400 kPa, T1=35°C）、透平入口温度（如T5=599.85°C）、主循环压比等，这些通常直接取自论文中的设计点或优化结果（例如论文表8、表10）。
    *   **ORC循环关键参数设定**：
        *   ORC的蒸发压力 ([`P_eva_kPa_orc`](cycle_setup_parameters.json): 1500.0 kPa) 和冷凝压力 ([`P_cond_kPa_orc`](cycle_setup_parameters.json): 445.10 kPa) 是基于论文表10中ORC工质R245fa的状态点09（透平入口）和状态点011（泵进口/冷凝器出口）的压力值设定的。
        *   ORC泵进口温度 ([`T_pump_in_C_orc`](cycle_setup_parameters.json): 58.66°C) 同样参考了论文表10的状态点011。
        *   ORC透平进口的目标过热度 ([`delta_T_superheat_orc_K`](cycle_setup_parameters.json): 20.96 K) 是根据论文表10状态点09的温度（127.76°C）与R245fa在1.5MPa下的饱和温度（约106.8°C）之差计算得出的。
        *   这些参数是影响ORC性能（如输出功、效率、所需换热量）的关键输入。改变它们（例如调整蒸发/冷凝压力、过热度）会直接导致ORC循环热力学状态的变化和性能的改变。模拟器允许通过修改 [`cycle_setup_parameters.json`](cycle_setup_parameters.json) 文件来调整这些输入值，以进行不同工况的分析。
*   **部件性能参数**:
    *   压缩机、泵、透平的等熵效率（例如，S-CO2透平效率ηT=0.9，压缩机效率ηC=0.85；ORC透平效率ηTO=0.8，泵效率ηPO=0.75）。这些效率值主要依据论文中的假设（如论文表6中提及的S-CO2部件效率）。部分参数（尤其是在论文未明确给出所有部件效率时）可能是为了使整体模拟结果更接近论文数据而进行的合理设定或微调。如果某些效率值是基于试错法或拟合得到的，脚本的注释或此文档会尝试指出。在进行参数研究时，这些效率值也是重要的可变因素。
    *   回热器（HTR, LTR）的效能（如0.86），同样基于论文设定。
*   **质量流量**: 初始的质量流量数据（如S-CO2主压缩机流量1945.09 kg/s，总流量2641.42 kg/s）是基于论文表10中的数据或推算得到的，这些流量是系统能量平衡和性能计算的关键。
*   **其他参数**: 如换热器的最小温差约束、燃料热值和价格等，这些参数用于更详细的经济性或特定工况分析，其来源也是论文或相关工程数据。

脚本中的注释通常会指明特定参数的来源或参考依据。

## 5. 后续计划 (简要)

基于当前这套代码，未来可以进行以下一些工作：

*   **参数敏感性分析**: 研究关键设计参数（如透平入口温度、压比、部件效率、换热器效能等）的变化对系统性能（如效率、输出功）的影响。
*   **系统优化**: 结合优化算法（如遗传算法、粒子群算法），以系统总效率最高或单位成本最低等为目标，对循环参数进行优化。
*   **㶲分析与㶲损失定位**: 更详细地计算和分析系统中各个部件的㶲损失，找出主要的不可逆损失环节，为系统改进提供方向。
*   **不同工况分析**: 模拟系统在不同外部条件（如热源温度变化、环境温度变化）下的性能表现。
*   **动态模拟**: (当前为稳态模拟) 如果需要，可以扩展到动态模拟，研究系统的启停过程、负荷变化响应等。
*   **经济性分析**: 结合成本模型，对系统的投资回报、发电成本等进行经济性评估。

这套代码为深入研究和优化超临界CO2布雷顿循环及其余热回收系统提供了一个良好的起点。